# 各言語でメル周波数ケプストラム係数(MFCC)取得までのベンチマーク取ってみたい

音声認識などの特徴量として取得するメル周波数ケプストラム係数(Mel Frequency Cepstral Coefficient, MFCC)の取得について、以下言語のベンチマークを取ります。参考になれば幸いです。

* Python
* F#
* Swift
* Rust
* 候補から外れそうなもの
    * C#
    * C++
* 候補から外れたもの
    * Java

## 所感(随時追記)

2021/02/12: Rust楽しいからRustで良い気がしてきた・・・。しかし一応具体的な数値は出しておきたい。F#とSwiftまでは。

## 背景

本記事のメインではないですが、今作成したいアプリの宣伝も兼ねてベンチマークを取った背景を述べさせてください。

いま、音声に対してその声色などの特徴に合う吹き出しをダイナミックに表示するGUIアプリを作りたいという目標のもと、レスポンス速度や作りやすさを踏まえてベストな言語を探していたので、参考のためにベンチマークを取ることにしました。

最初はそのアプリを作成する言語はPythonだけで良いと思っていましたが、ユーザーとのインタラクティブなアプリにおいては「NumPyだとしても遅いのでは」という懸念がありました。.NET系などのエコシステムが整っている言語やC++などの高速な言語など候補が出てきたのですが、それぞれに懸念点があって決めきれないため実際に肌で感じることが良いという決断になりました。

ベンチマークを取った経験が無いのでその経験やスキル自体に将来的な大きな価値がある気がするため、ベンチマークに時間をかける価値も十分にあると思いました。言語の特徴を感じるだけでなく、こうして記事にすることで他の人の参考にもなれば良いなと思いました。プログラミングで線形代数や信号処理をするにとっても参考になる気がします。

上記で候補として挙げた言語は使い道やエコシステムなどを考えた際に出てきた候補です。以下はその言語を使うことによる良い点と懸念点をまとめたものです。

言語   | 良い点                                         | 懸念点
---    | ---                                            | ---
Python | 一番簡単、資料多い                             | 速度はNumPyでも微妙かもしれない。保守性も微妙
C#     | .NET、資料多い、Xamarinの可能性                | 最速ではない。
F#     | .NET、関数型、Xamarinの可能性                  | 資料が少ない。最速ではない。
Swift  | Apple限定ならいろいろできる                    | Apple限定(Accelerateフレームワーク)
Java   | JVM、資料多い                                  | 信号処理の活発なライブラリがない。
Rust   | 最速、安全                  　                 | GUIが微妙らしい。難しいかもしれない。
C++    | 最速、豊富なライブラリ                         | 難易度が高い。

使用端末はPCのみを想定していましたが、iOSやAndroidアプリでも将来的に利用できる可能性を考え、C#やF#、Java、Swiftも候補に挙がりました。(のちにJavaは良さげなライブラリがないため候補から外れました)
RustとC++は最速の言語として候補に挙がりました。

あくまでPCでの利用が主なため、以下のような順でベンチマーク取得に取り組みます。

言語   | 決め方
---    | ---
Python | 一番楽。他のとそこまで差が出ない場合はコレで開発
Rust   | 最速値取得のため。やってみて案外行けそうと思ったらコレで開発
===    | === 壁 ===
F#     | Xamarinにワンチャン懸けたい気持ちがある。速度が思った以上に出るならコレで開発
Swift  | Apple限定なら最有力候補なのでやってみる。速度が思ったより出ないなら諦める。
===    | === 壁 ===
C#     | C#やるならF#やりたい。
C++    | 難易度とパッケージ管理的に一番抵抗感が大きい。
Java   | 候補外

## ベンチマーク一覧

以降TODO

## ベンチマーク取得方法

### 条件

```
MacBook Pro (13-inch, 2018)
OS: macOS Big Sur
CPU: Intel Core i5-8259U @ 2.3 GHz (4 cores)
DRAM: 16GB 2,133MHz LPDDR3
GPU: Intel Iris Plus Graphics 655
```

### MFCCを求める

MFCCを求めるための条件
* サンプリング周波数=16kHz
* 次元数=12
* FFTの要素数=1024(16kHzにおいては64ms)
* STFTのホップサイズ=256
* メルフィルタバンクの次元数=20
* DCTの定義=DCT-Ⅱ

1. ストリーミングのように、1分間のwavファイルを128ミリ秒のフレームに分けてバッファにとっておき、そのあと計測をスタートしてそれぞれMFCCを求める。
    * マイク入力を想定するのでwhile文で実装する。

なお、作りやすさも見たいのでパッケージ化を試みる。パッケージ名はテキトーに`audio.feature`としておく。

### Python

ベンチマーク取得ツール: pytest-benchmark

### Rust

ベンチマーク取得ツール: criterion

### F#

TODO

### Swift

TODO
